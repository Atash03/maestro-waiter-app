# Maestro Waiter App - Development Progress

## 2026-01-19

### Task 1.1: Install required dependencies (COMPLETED)

**Dependencies Installed:**
- zustand@5.0.10 (state management)
- @tanstack/react-query@5.90.19 (server state)
- axios@1.13.2 (HTTP client)
- react-native-sse@1.2.1 (Server-Sent Events)
- @react-native-async-storage/async-storage@2.2.0 (persistence)
- react-native-uuid@2.0.3 (device ID generation)
- react-native-toast-message@2.3.3 (notifications)
- expo-secure-store@15.0.8 (secure credential storage)

**Testing Dependencies Installed:**
- jest@30.2.0
- jest-expo@54.0.16
- @types/jest@30.0.0
- @testing-library/react-native@13.3.3
- @testing-library/jest-native@5.4.3
- ts-jest@29.4.6

**Files Created:**
- jest.config.js - Jest configuration for Expo
- jest.setup.js - Jest setup with mocks for native modules
- src/__tests__/dependencies.test.ts - Tests to verify all dependencies are installed correctly

**Test Results:**
- 12 tests passing, all dependencies verified to be correctly installed and importable

**Linting:**
- All files pass Biome linting checks

---

### Task 1.2: Create TypeScript types from API documentation (COMPLETED)

**Files Created:**
- `src/types/enums.ts` - All enums (Role, OrderType, OrderStatus, OrderItemStatus, WaiterCallStatus, MenuCategoryType, PaymentMethod, ReservationStatus, CustomerType, DeviceType, DevicePlatform, SortOrder, ServiceFeeType, DiscountType, DiscountValueType, DiscountApplicableTo, BillStatus, ReasonTemplateType, DayOfWeek)
- `src/types/models.ts` - Domain models (Translation, Account, Zone, Table, WaiterCall, MenuCategory, MenuItemAvailability, Extra, MenuItem, CustomerAddress, Customer, OrderItemExtra, OrderItem, Order, BillItem, Bill, BillDiscount, Payment, Discount, ServiceFee, Reservation, ReasonTemplate)
- `src/types/api.ts` - All API request/response types including:
  - Common types (PaginatedResponse, PaginationParams, SortParams, ApiError)
  - Authentication types (LoginRequest, LoginResponse, CheckSessionResponse)
  - Waiter call types (CreateWaiterCallRequest, GetWaiterCallsParams, etc.)
  - Order types (CreateOrderRequest, GetOrdersParams, UpdateOrderRequest, etc.)
  - Order item types (CreateOrderItemRequest, BatchCreateOrderItemsRequest, BatchUpdateOrderItemStatusRequest, KitchenViewResponse, etc.)
  - Table & Zone types
  - Menu types
  - Customer types
  - Bill & Payment types
  - Discount types
  - Reservation types
  - Service Fee types
  - Reason Template types
  - SSE Event types (WaiterCallEvent, OrderCreatedEvent, OrderItemCreatedEvent, etc.)
- `src/types/index.ts` - Central export file for all types

**Files Modified:**
- `jest.config.js` - Added ts-jest transform for proper TypeScript support

**Tests Created:**
- `src/__tests__/types.test.ts` - 70 tests covering:
  - All 19 enums with value verification
  - 14 model types with object creation
  - 12 API request/response types
  - 5 SSE event types
  - Type export verification

**Test Results:**
- 82 tests passing (12 dependency tests + 70 type tests)

**Linting:**
- All files pass Biome linting checks

---

### Task 1.3: Implement API client (COMPLETED)

**Files Created:**
- `src/services/api/client.ts` - Full-featured API client with:
  - `ApiClient` class with configurable base URL, timeout, and retry settings
  - `ApiClientError` custom error class with status code, error code, and retry flag
  - Request interceptor for automatic session header injection (maestro-session-id, x-device-id, x-device-type, x-device-platform, x-device-name, x-app-version)
  - Response interceptor for error handling:
    - 401 (Unauthorized): Clears session and triggers onUnauthorized callback
    - 403 (Forbidden): Triggers onForbidden callback with error message
  - Exponential backoff retry logic for network failures and server errors
  - HTTP methods: GET, POST, PUT, PATCH, DELETE
  - Session management: setSessionInfo, getSessionInfo
  - Platform utilities: getDevicePlatform, getDeviceType
  - Singleton pattern: initializeApiClient, getApiClient, isApiClientInitialized, resetApiClient
- `src/services/api/index.ts` - Central export file for API services

**Tests Created:**
- `src/__tests__/api-client.test.ts` - 33 tests covering:
  - Constructor and axios instance creation
  - Session management (set/get/clear)
  - Request interceptor header injection
  - Response error handling (401, 403, network errors, timeout, server errors)
  - HTTP methods (GET, POST, PUT, PATCH, DELETE)
  - Retry logic with exponential backoff
  - ApiClientError class
  - Singleton functions
  - Platform utilities

**Test Results:**
- 115 tests passing (12 dependency + 70 types + 33 API client tests)

**Linting:**
- All files pass Biome linting checks

---

### Task 1.4: Create API endpoint modules (COMPLETED)

**Files Created/Updated:**
- `src/services/api/auth.ts` - Authentication endpoints:
  - `login(request)` - POST /auth/login
  - `checkSession()` - GET /auth/check
  - `logout()` - POST /auth/logout

- `src/services/api/orders.ts` - Order CRUD operations:
  - `createOrder(request)` - POST /order
  - `getOrders(params?)` - GET /order with query params
  - `getOrder(id)` - GET /order/:id
  - `updateOrder(id, request)` - PUT /order/:id

- `src/services/api/orderItems.ts` - Order item operations:
  - `createOrderItem(request)` - POST /order-item
  - `batchCreateOrderItems(request)` - POST /order-item/batch
  - `getOrderItems(params?)` - GET /order-item
  - `getOrderItem(id)` - GET /order-item/:id
  - `updateOrderItem(id, request)` - PUT /order-item/:id
  - `batchUpdateOrderItemStatus(request)` - PATCH /order-item/batch/status
  - `getKitchenView()` - GET /order-item/kitchen/view

- `src/services/api/tables.ts` - Table queries:
  - `getTables(params?)` - GET /table
  - `getTable(id)` - GET /table/:id

- `src/services/api/zones.ts` - Zone queries:
  - `getZones(params?)` - GET /zone
  - `getZone(id)` - GET /zone/:id

- `src/services/api/menu.ts` - Menu categories and items:
  - `getMenuCategories(params?)` - GET /menu-category
  - `getMenuCategory(id)` - GET /menu-category/:id
  - `getMenuItems(params?)` - GET /menu-item
  - `getMenuItem(id)` - GET /menu-item/:id

- `src/services/api/waiterCalls.ts` - Waiter call management:
  - `createWaiterCall(request)` - POST /waiter-call
  - `getWaiterCalls(params?)` - GET /waiter-call
  - `getWaiterCall(id)` - GET /waiter-call/:id
  - `acknowledgeWaiterCall(id)` - PUT /waiter-call/:id/acknowledge
  - `completeWaiterCall(id)` - PUT /waiter-call/:id/complete
  - `cancelWaiterCall(id)` - PUT /waiter-call/:id/cancel

- `src/services/api/bills.ts` - Billing operations:
  - `createBill(request)` - POST /bill
  - `getBills(params?)` - GET /bill
  - `getBill(id)` - GET /bill/:id
  - `updateBill(id, request)` - PUT /bill/:id
  - `updateBillDiscounts(id, request)` - PUT /bill/:id/discounts
  - `calculateBill(request)` - POST /bill/calculate

- `src/services/api/payments.ts` - Payment processing:
  - `createPayment(request)` - POST /payment
  - `getPayments(params?)` - GET /payment

- `src/services/api/customers.ts` - Customer lookup:
  - `getCustomers(params?)` - GET /customer
  - `getCustomer(id)` - GET /customer/:id

- `src/services/api/discounts.ts` - Discount queries:
  - `getDiscounts(params?)` - GET /discount
  - `getDiscount(id)` - GET /discount/:id
  - `calculateDiscounts(request)` - POST /discount/calculate

- `src/services/api/extras.ts` - Extras queries:
  - `getExtras(params?)` - GET /extra
  - `getExtra(id)` - GET /extra/:id

- `src/services/api/index.ts` - Updated to export all endpoint modules

**Tests Created:**
- `src/__tests__/api-endpoints.test.ts` - 55 tests covering:
  - Auth API (3 tests): login, checkSession, logout
  - Orders API (5 tests): createOrder, getOrders with/without params, getOrder, updateOrder
  - Order Items API (7 tests): createOrderItem, batchCreateOrderItems, getOrderItems, getOrderItem, updateOrderItem, batchUpdateOrderItemStatus, getKitchenView
  - Tables API (3 tests): getTables with/without params, getTable
  - Zones API (3 tests): getZones with/without params, getZone
  - Menu API (6 tests): getMenuCategories with/without params, getMenuCategory, getMenuItems with/without params, getMenuItem
  - Waiter Calls API (7 tests): createWaiterCall, getWaiterCalls with/without params, getWaiterCall, acknowledgeWaiterCall, completeWaiterCall, cancelWaiterCall
  - Bills API (7 tests): createBill, getBills with/without params, getBill, updateBill, updateBillDiscounts, calculateBill
  - Payments API (3 tests): createPayment, getPayments with/without params
  - Customers API (3 tests): getCustomers with/without params, getCustomer
  - Discounts API (4 tests): getDiscounts with/without params, getDiscount, calculateDiscounts
  - Extras API (3 tests): getExtras with/without params, getExtra
  - API exports test (1 test): verifies all functions are exported from index

**Test Results:**
- 170 tests passing (12 dependency + 70 types + 33 API client + 55 API endpoints tests)

**Linting:**
- All files pass Biome linting checks

---

### Task 1.5: Implement auth store (COMPLETED)

**Files Created:**
- `src/stores/authStore.ts` - Full-featured Zustand authentication store with:
  - `AuthState` interface defining all state and actions
  - Session ID storage (persisted securely using expo-secure-store)
  - User account info (Account from API)
  - Device ID management (generate UUID once on first launch, persist across app reinstalls)
  - `initialize()` - Restores session on app start, validates with server
  - `login(request, rememberMe?)` - Authenticates user, saves session, updates API client
  - `logout()` - Clears session, calls API logout, clears storage
  - `validateSession()` - Checks if current session is still valid with server
  - `clearError()` - Clears error messages
  - `setRememberMe(value)` - Sets remember me preference
  - Automatic API client session header injection
  - SecureStore with AsyncStorage fallback for environments where SecureStore isn't available
  - "Remember me" feature that saves username for next login
- `src/stores/index.ts` - Central export file for stores

**Custom Hooks Exported:**
- `useAuthStore` - Full store access
- `useIsAuthenticated` - Optimized hook for auth status only
- `useAccount` - Optimized hook for account info only
- `useAuthLoading` - Loading states (isInitializing, isLoggingIn, isLoggingOut)
- `useAuthError` - Error state only
- `useRememberMe` - Remember me data (rememberMe flag and savedUsername)

**Files Modified:**
- `jest.setup.js` - Updated AsyncStorage mock to use proper structure with __esModule flag

**Tests Created:**
- `src/__tests__/auth-store.test.ts` - 31 tests covering:
  - Initial state verification
  - Device ID creation and persistence
  - Session restoration on initialize
  - Invalid session handling
  - Remember me preference loading
  - SecureStore to AsyncStorage fallback
  - Successful login with session persistence
  - Login progress state (isLoggingIn)
  - Remember me username saving
  - Login failure error handling
  - Device ID not initialized error
  - API client session info updates
  - Successful logout with session clearing
  - Logout progress state (isLoggingOut)
  - Logout error resilience (clears session even if API fails)
  - Session validation
  - Error clearing
  - Remember me preference setting
  - Hook exports verification
  - AuthState type export verification
  - Store index exports verification

**Test Results:**
- 201 tests passing (12 dependency + 70 types + 33 API client + 55 API endpoints + 31 auth store tests)

**Linting:**
- All files pass Biome linting checks

---

### Task 1.6: Create Login Screen (COMPLETED)

**Files Created/Updated:**
- `app/(auth)/login.tsx` - Full-featured login screen with:
  - Clean, branded design with Maestro logo (M in primary color)
  - Welcome title and subtitle animation on mount
  - Username and password fields with validation
  - Real-time field error clearing on input change
  - "Remember me" checkbox option using SecureStore (via authStore)
  - Loading state with ActivityIndicator during authentication
  - Comprehensive error handling with user-friendly messages:
    - 401: "Invalid username or password"
    - 403: Device limit exceeded message
    - Network error: "Unable to connect to server"
    - Timeout: "Connection timed out"
  - Animated logo entrance (scale + opacity with spring)
  - Animated form entrance (slide up + fade in)
  - Shake animation on validation/login errors
  - Button press animation (scale feedback)
  - KeyboardAvoidingView for proper keyboard handling
  - Auto-redirect to main app when authenticated
  - Pre-filled username when "Remember me" was enabled
  - All interactive elements have testIDs for testing

- `app/(auth)/_layout.tsx` - Auth group layout:
  - Stack navigator with hidden headers
  - Login screen registration

- `app/_layout.tsx` - Root layout with:
  - React Query provider setup
  - API client initialization
  - Auth store initialization on app start
  - Protected route logic (redirect to login if not authenticated)
  - Loading screen while initializing
  - Theme provider (light/dark mode support)
  - SplashScreen management

**Tests Created:**
- `src/__tests__/login-screen.test.tsx` - 16 tests covering:
  - Auth store integration (hook usage, authentication state)
  - Login API error handling (401, 403, network, timeout)
  - Remember me feature (saved username, disabled state)
  - Login function (credentials, remember me flag, error rejection)
  - Loading state tracking
  - Error state tracking and clearing
  - Module exports verification

**Test Results:**
- 217 tests passing (12 dependency + 70 types + 33 API client + 55 API endpoints + 31 auth store + 16 login screen tests)

**Linting:**
- All files pass Biome linting checks

---

### Task 1.7: Implement protected route logic (COMPLETED)

**Files Created:**
- `src/hooks/useProtectedRoute.ts` - Protected route hook with:
  - `useProtectedRoute()` - Main hook for managing auth-based navigation
    - Returns `isNavigationReady` and `isCheckingAuth` states
    - Redirects unauthenticated users to login screen
    - Redirects authenticated users away from auth screens to main app
    - Handles navigation ready state checking
  - `useIsRouteProtected()` - Simple hook to check if current route is protected
    - Returns true when in `(tabs)` or `(main)` route groups
  - `useAuthCallbacks()` - Hook to set up API client callbacks for auth errors
    - Sets `onUnauthorized` callback (401) - logs out and redirects to login
    - Sets `onForbidden` callback (403) - logs warning for debugging
- `src/hooks/index.ts` - Central export file for custom hooks

**Files Updated:**
- `src/services/api/client.ts` - Added public getter/setter properties for callbacks:
  - `onUnauthorized` - Property getter/setter for 401 callback
  - `onForbidden` - Property getter/setter for 403 callback
  - Deprecated `setOnUnauthorized()` and `setOnForbidden()` methods in favor of properties
- `app/_layout.tsx` - Updated to use new hooks:
  - Uses `useProtectedRoute()` for navigation management
  - Uses `useAuthCallbacks()` to set up API error handlers
  - Simplified navigation logic by delegating to hooks
- `jest.config.js` - Added protected-route.test.ts to test match patterns

**Tests Created:**
- `src/__tests__/protected-route.test.ts` - 24 tests covering:
  - useProtectedRoute hook:
    - Navigation ready state detection
    - Auth checking state during initialization
    - Redirect to login when not authenticated
    - Redirect to tabs when authenticated in auth group
    - No redirect when authenticated in main group
    - No redirect when not authenticated in auth group
    - No navigation when navigation not ready
    - (main) group handled as protected route
  - useIsRouteProtected hook:
    - Returns true for (tabs) group
    - Returns true for (main) group
    - Returns false for (auth) group
    - Returns false at root
  - useAuthCallbacks hook:
    - Sets onUnauthorized callback on API client
    - Sets onForbidden callback on API client
    - Calls logout and redirects when onUnauthorized triggered
    - Logs warning when onForbidden triggered
  - Hook exports verification
  - Hooks index exports verification
  - API client callback properties

**Test Results:**
- 241 tests passing (12 dependency + 70 types + 33 API client + 55 API endpoints + 31 auth store + 16 login screen + 24 protected route tests)

**Linting:**
- All files pass Biome linting checks

---

### Task 1.8: Create base UI components (COMPLETED)

**Files Created:**
- `components/ui/Button.tsx` - Full-featured button component with:
  - Variants: primary, secondary, outline, ghost, destructive
  - Sizes: sm, md, lg
  - Loading state with ActivityIndicator
  - Disabled state with visual feedback
  - Press animation using React Native Reanimated
  - Left/right icon support
  - Full width option
  - Theme-aware colors

- `components/ui/Input.tsx` - Text input component with:
  - Label, error, and hint support
  - Left/right icon support
  - Focus animation on border
  - Disabled state
  - Theme-aware colors

- `components/ui/Card.tsx` - Container component with:
  - Padding options: none, sm, md, lg
  - Elevated (shadow) option
  - Bordered option
  - Pressable with animation
  - Theme-aware colors

- `components/ui/Badge.tsx` - Status badge component with:
  - Variants: default, primary, success, warning, error, info, available, occupied, reserved, pending, preparing, ready
  - Sizes: sm, md, lg
  - Theme-aware colors matching PRD status colors

- `components/ui/Avatar.tsx` - Avatar component with:
  - Sizes: xs, sm, md, lg, xl
  - Image source support
  - Initials fallback (generated from name)
  - Default placeholder (?)

- `components/ui/Spinner.tsx` - Loading indicator with:
  - Sizes: sm, md, lg
  - Custom color support
  - Uses ActivityIndicator

- `components/ui/Toast.tsx` - Notification toast with:
  - Types: success, error, warning, info
  - Slide-in animation
  - Auto-dismiss with configurable duration
  - Close button
  - Icon based on type

- `components/ui/Modal.tsx` - Modal component with:
  - Title and footer support
  - Scale and opacity animations
  - Backdrop press to close (configurable)
  - Theme-aware colors

- `components/ui/Skeleton.tsx` - Loading skeleton with:
  - Variants: text, circular, rectangular, rounded
  - Custom width/height
  - Shimmer animation
  - SkeletonGroup component for repeated skeletons

- `components/ui/index.ts` - Central export file for all UI components

**Theme Constants Updated:**
- `constants/theme.ts` - Added design tokens from PRD:
  - BrandColors: primary (#F94623), primaryLight, primaryDark
  - StatusColors: available, occupied, reserved, needsAttention, ready, preparing, pending
  - CategoryColors: kitchen, bar
  - Spacing: 4px grid (xs, sm, md, lg, xl, 2xl, 3xl, 4xl)
  - BorderRadius: sm, md, lg, xl, 2xl, full
  - Extended Colors with light/dark themes including textSecondary, textMuted, backgroundSecondary, border colors, error/success/warning/info colors

**Files Modified:**
- `jest.setup.js` - Added react-native-reanimated mock
- `jest.config.js` - Updated test patterns for UI components

**Tests Created:**
- `src/__tests__/ui-components-render.test.tsx` - 62 tests covering:
  - Theme constants (BrandColors, StatusColors, CategoryColors, Spacing, BorderRadius, Colors)
  - UI component exports verification
  - Button render tests (variants, sizes, loading, disabled, icons)
  - Input render tests (label, error, hint, icons, disabled)
  - Card render tests (padding, pressable, elevated, bordered)
  - Badge render tests (variants, sizes)
  - Avatar render tests (name, sizes, image source)
  - Spinner render tests (sizes, color)
  - Modal component verification
  - Skeleton render tests (variants, dimensions)
  - SkeletonGroup render tests (count, direction, spacing)

**Test Results:**
- 303 tests passing (12 dependency + 70 types + 33 API client + 55 API endpoints + 31 auth store + 16 login screen + 24 protected route + 62 UI components tests)

**Linting:**
- All files pass Biome linting checks (1 acceptable warning for array index key in SkeletonGroup)

---

### Task 2.1: Create table store (COMPLETED)

**Files Created:**
- `src/stores/tableStore.ts` - Full-featured Zustand table store with:
  - `TableState` interface defining all state and actions
  - Tables array cache from API
  - Zones array cache from API
  - Selected table ID tracking
  - Selected zone ID tracking
  - Loading states for tables and zones (independent)
  - Error state handling
  - `fetchTables()` - Fetches all tables from API
  - `fetchZones()` - Fetches all zones from API
  - `fetchAll()` - Fetches both tables and zones in parallel
  - `selectTable(tableId)` - Selects a table by ID
  - `selectZone(zoneId)` - Selects a zone by ID (clears table selection if table not in new zone)
  - `getTableById(tableId)` - Returns table by ID
  - `getZoneById(zoneId)` - Returns zone by ID
  - `getTablesByZone(zoneId)` - Returns all tables in a specific zone
  - `clearError()` - Clears error message
  - `reset()` - Resets store to initial state

**Custom Hooks Exported:**
- `useTableStore` - Full store access
- `useTables` - Optimized hook for tables array only
- `useZones` - Optimized hook for zones array only
- `useSelectedTable` - Returns the full selected table object
- `useSelectedZone` - Returns the full selected zone object
- `useTablesInSelectedZone` - Returns tables filtered by selected zone
- `useTableLoading` - Loading states (isLoadingTables, isLoadingZones, isLoading)
- `useTableError` - Error state only
- `useSelectedIds` - Selected IDs (selectedTableId, selectedZoneId)

**Files Modified:**
- `src/stores/index.ts` - Updated to export all table store functions and types
- `jest.config.js` - Added table-store.test.ts to test match patterns

**Tests Created:**
- `src/__tests__/table-store.test.ts` - 36 tests covering:
  - Initial state verification
  - fetchTables success and error handling
  - fetchZones success and error handling
  - fetchAll parallel execution
  - selectTable functionality
  - selectZone functionality (including table selection clearing)
  - getTableById functionality
  - getZoneById functionality
  - getTablesByZone filtering
  - clearError functionality
  - reset functionality
  - Loading state transitions
  - All hook exports verification
  - TableState type export verification
  - Store index exports verification

**Test Results:**
- 339 tests passing (303 previous + 36 table store tests)

**Linting:**
- All files pass Biome linting checks (1 acceptable warning for array index key in SkeletonGroup)

---

### Task 2.2: Implement Zones/Tables data fetching (COMPLETED)

**Files Created:**
- `src/hooks/useTableQueries.ts` - React Query hooks for tables and zones data fetching with:
  - Query key factories (`tableQueryKeys`, `zoneQueryKeys`) for targeted cache invalidation
  - `useTables(options?)` - Fetch all tables with optional filtering/pagination
  - `useTable({ id })` - Fetch a single table by ID
  - `useZones(options?)` - Fetch all zones with optional filtering/pagination
  - `useZone({ id })` - Fetch a single zone by ID
  - `useTablesAndZones(options?)` - Combined hook to fetch both tables and zones together
  - `useTablesByZone(tables, zoneId)` - Utility to filter tables by zone from cached data
  - `useTableCacheActions()` - Cache management utilities:
    - `invalidateTables(params?)` - Invalidate table queries
    - `invalidateZones(params?)` - Invalidate zone queries
    - `invalidateAll()` - Invalidate both tables and zones
    - `prefetchTables(params?)` - Prefetch table data
    - `prefetchZones(params?)` - Prefetch zone data
    - `prefetchAll()` - Prefetch both tables and zones
  - Default stale time: 5 minutes
  - Default cache time: 30 minutes
  - Pull-to-refresh support via `refetchAll()` in combined hook

**Files Modified:**
- `src/hooks/index.ts` - Updated to export all table query hooks and types
- `jest.config.js` - Added table-queries.test.tsx to web test environment

**Tests Created:**
- `src/__tests__/table-queries.test.tsx` - 38 tests covering:
  - Query keys generation (12 tests)
    - tableQueryKeys.all, lists, list with/without params, details, detail
    - zoneQueryKeys.all, lists, list with/without params, details, detail
  - useTables hook (3 tests)
    - Successful fetch
    - Fetch with params
    - Error handling
  - useTable hook (2 tests)
    - Fetch single table by ID
    - Disabled when ID is empty
  - useZones hook (3 tests)
    - Successful fetch
    - Fetch active zones only
    - Error handling
  - useZone hook (2 tests)
    - Fetch single zone by ID
    - Disabled when ID is empty
  - useTablesAndZones hook (3 tests)
    - Fetch both tables and zones
    - Combined error reporting
    - refetchAll function
  - useTablesByZone utility (4 tests)
    - Filter by zone ID
    - Return all when zoneId undefined
    - Return empty when tables undefined
    - Return empty when no match
  - useTableCacheActions hook (7 tests)
    - Return all cache action functions
    - invalidateTables with/without params
    - invalidateZones
    - invalidateAll
    - prefetchTables
    - prefetchZones
    - prefetchAll
  - Hook exports verification (2 tests)

**Test Results:**
- 377 tests passing (339 previous + 38 table queries tests)

**Linting:**
- All files pass Biome linting checks (1 acceptable warning for array index key in SkeletonGroup)

---

### Task 2.3: Create Floor Plan Screen (COMPLETED)

**Files Created:**
- `app/(tabs)/tables/index.tsx` - Full-featured Floor Plan Screen with:
  - Zone tabs/segmented control for filtering tables by zone
  - Interactive floor plan canvas with tables positioned using x, y, width, height from API
  - Pinch-to-zoom gesture using react-native-gesture-handler `Gesture.Pinch()`
  - Pan gesture for moving around the floor plan using `Gesture.Pan()`
  - Combined simultaneous gesture handling for smooth interactions
  - Table items with:
    - Color-coded status indication (available/occupied/reserved/needsAttention)
    - Press animation using react-native-reanimated
    - Table title and capacity display
    - Attention indicator for tables needing attention
  - Zone tabs with horizontal scrolling
  - "All" tab for viewing all tables across zones
  - Status legend (collapsible) explaining color codes
  - Pull-to-refresh functionality using RefreshControl
  - Loading skeleton state for initial load
  - Error state with retry button
  - Empty state for when no tables exist
  - Loading overlay indicator for background fetches
  - Full TypeScript types and testIDs for all interactive elements
  - Theme-aware colors supporting light/dark mode

**Files Modified:**
- `app/(tabs)/_layout.tsx` - Added Tables tab with `square.grid.2x2.fill` icon as the first tab
- `jest.setup.js` - Added mock for `react-native-gesture-handler` with:
  - GestureHandlerRootView, GestureDetector components
  - Gesture.Pinch(), Gesture.Pan(), Gesture.Simultaneous(), Gesture.Tap() methods
  - Support for gesture callbacks (onStart, onUpdate, onEnd)

**Tests Created:**
- `src/__tests__/floor-plan-screen.test.tsx` - 27 tests covering:
  - Data fetching integration (useTablesAndZones hook usage, loading/error states)
  - Zone filtering (useTablesByZone utility, zone selection)
  - Table selection (selectTable, deselection)
  - Zone data structure (active filtering, translation support)
  - Table data structure (positioning, capacity, color, zoneId)
  - Coordinate parsing (string to number conversion)
  - Status colors verification
  - Refetch functionality for pull-to-refresh
  - Module export verification
  - Translation helper function
  - Empty state handling
  - Canvas bounds calculation
  - Table store integration

**Features Implemented:**
- Zone tabs with active zone filtering
- Interactive floor plan canvas
- Tables positioned using x, y, width, height from API
- Pinch-to-zoom and pan gestures
- Color-coded table status (available, occupied, reserved, needsAttention)
- Pull-to-refresh with RefreshControl
- Loading skeleton on initial load
- Error state with retry functionality
- Empty state for no tables
- Status legend (collapsible)
- Press animation on table items
- Theme-aware styling (light/dark mode support)

**Test Results:**
- 404 tests passing (377 previous + 27 floor plan screen tests)

**Linting:**
- All files pass Biome linting checks

---

### Task 2.4: Create Table Component (COMPLETED)

**Files Created:**
- `components/tables/TableItem.tsx` - Full-featured table component with:
  - Visual representation based on table dimensions (width, height)
  - Color-coded status indication using StatusColors from theme:
    - Available: green (#4CAF50)
    - Occupied: primary/orange (#F94623)
    - Reserved: blue (#2196F3)
    - Needs Attention: amber (#FF9800)
  - Pulsing animation for tables with pending waiter calls or needing attention
  - Table title/number display centered on the table
  - Capacity display (number of seats)
  - Guest count display with emoji (ðŸ‘¥) when occupied
  - Active order indicator (ðŸ“‹) when table has active order
  - Attention indicator (âš ï¸) when table needs attention
  - Press animation with scale effect using react-native-reanimated
  - Selection state with different opacity
  - Proper coordinate and dimension parsing (handles strings, empty values, invalid values)
  - `getStatusColor(status)` helper function exported for reuse

- `components/tables/index.ts` - Central export file for table components:
  - Exports TableItem component
  - Exports TableItemData, TableItemProps, TableStatus types
  - Exports getStatusColor helper function

**Files Modified:**
- `app/(tabs)/tables/index.tsx` - Updated to use the new TableItem component:
  - Removed inline TableItem component implementation
  - Imports TableItem from `@/components/tables`
  - Removed unused styles and imports

- `jest.setup.js` - Updated react-native-reanimated mock:
  - Added `cancelAnimation` function
  - Added `interpolate` function

- `jest.config.js` - Added `table-item.test.tsx` to web test match patterns

**Types Defined:**
- `TableStatus` - Union type: 'available' | 'occupied' | 'reserved' | 'needsAttention'
- `TableItemData` - Extends Table model with status properties:
  - status: TableStatus
  - guestCount?: number
  - hasActiveOrder?: boolean
  - hasPendingCall?: boolean
- `TableItemProps` - Component props:
  - table: TableItemData
  - onPress?: (table: Table) => void
  - onLongPress?: (table: Table) => void
  - isSelected?: boolean
  - testID?: string

**Tests Created:**
- `src/__tests__/table-item.test.tsx` - 40 tests covering:
  - getStatusColor helper function (5 tests):
    - Returns correct color for available, occupied, reserved, needsAttention statuses
    - Returns available color for unknown status (fallback)
  - TableItem rendering (4 tests):
    - Renders table title correctly
    - Renders capacity when > 0 and not showing guest count
    - Does not render capacity text when capacity is 0
    - Renders correctly with default props
  - Status display (6 tests):
    - Renders correctly with all four status types (parameterized)
    - Renders attention indicator for needsAttention status
    - Does not show attention indicator for available status
    - Renders order indicator when hasActiveOrder is true
    - Does not show order indicator when status is needsAttention
  - Guest count display (3 tests):
    - Shows guest count when occupied and guestCount > 0
    - Does not show guest count when status is not occupied
    - Does not show guest count when guestCount is 0
  - Pulse animation (3 tests):
    - Renders pulse layer when hasPendingCall is true
    - Renders pulse layer when status is needsAttention
    - Does not render pulse layer for available status without pending call
  - Press handlers (4 tests):
    - Can render with onPress callback
    - Can render with onLongPress callback
    - Renders when onPress is not provided
    - Renders when onLongPress is not provided
  - Coordinate parsing (4 tests):
    - Renders with valid x and y coordinates
    - Handles empty coordinate strings
    - Handles undefined coordinate values
    - Handles non-numeric coordinate strings
  - Dimension parsing (3 tests):
    - Renders with valid width and height
    - Handles empty dimension strings
    - Handles invalid dimension strings
  - Selection state (2 tests):
    - Renders correctly when selected
    - Renders correctly when not selected
  - Color handling (2 tests):
    - Renders when table color is provided
    - Renders when table color is empty
  - Export verification (2 tests):
    - Exports TableItem component
    - Exports getStatusColor function

**Test Results:**
- 444 tests passing (404 previous + 40 table item tests)

**Linting:**
- All files pass Biome linting checks (1 acceptable warning for array index key in SkeletonGroup)

---

### Task 2.5: Implement Table Info Popup (COMPLETED)

**Files Created:**
- `components/tables/TableInfoPopup.tsx` - Full-featured table info popup component with:
  - Popup overlay displayed on table long-press
  - Animated entrance/exit using react-native-reanimated
  - Table information display:
    - Table name with status indicator
    - Status badge (Available, Occupied, Reserved, Needs Attention)
    - Capacity display (X seats)
    - Guest count (when occupied with guests > 0)
    - Time seated duration (formatted as Xh Ym)
    - Zone name (if available)
  - Active order summary section (when order exists):
    - Order code
    - Item count
    - Total amount
  - Quick action buttons:
    - "View Order" (when active order exists)
    - "New Order" / "Add Items" (changes label based on order existence)
    - "View Call" (when table has pending waiter call)
  - Close button and backdrop press to dismiss
  - Theme-aware colors (light/dark mode support)
  - Helper functions:
    - `formatDuration(dateString)` - Formats time duration from date to now
    - `getStatusBadgeVariant(status)` - Maps table status to badge variant
    - `getStatusLabel(status)` - Gets human-readable status label
    - `calculateOrderSummary(order)` - Extracts order summary from Order object
    - `getTranslatedText(translation, fallback)` - Gets text from Translation object

**Files Modified:**
- `components/tables/index.ts` - Updated to export TableInfoPopup component and related types
- `jest.config.js` - Added table-info-popup.test.tsx to web test match patterns

**Types Defined:**
- `TableInfoPopupProps` - Component props interface:
  - visible: boolean
  - onClose: () => void
  - table: TableItemData | null
  - activeOrder?: Order | null
  - onViewOrder?: (order: Order) => void
  - onNewOrder?: (table: Table) => void
  - onCallInfo?: (table: Table) => void
  - seatedAt?: string | null
  - testID?: string
- `OrderSummary` - Order summary data interface:
  - itemCount: number
  - totalAmount: string
  - orderCode: string
  - status: string

**Tests Created:**
- `src/__tests__/table-info-popup.test.tsx` - 43 tests covering:
  - Visibility (4 tests): render when visible, hide when not visible or no table
  - Table info display (5 tests): title, capacity, guest count, zone name
  - Status badge (4 tests): correct badge for all status types
  - Time seated (3 tests): display for occupied with seatedAt, hide when null or available
  - Order summary (5 tests): display when order exists, correct code/count/total
  - Action buttons (9 tests): View Order, New Order, Call Info visibility and callbacks
  - Close functionality (3 tests): close button, backdrop, callback provision
  - Edge cases (6 tests): missing zone, missing orderItems, undefined guestCount, invalid date
  - Export verification (3 tests): component and type exports

**Test Results:**
- 487 tests passing (444 previous + 43 table info popup tests)

**Linting:**
- All files pass Biome linting checks (1 acceptable warning for array index key in SkeletonGroup)

---

### Task 2.6: Create Table Detail Modal (COMPLETED)

**Files Created:**
- `components/tables/TableDetailModal.tsx` - Full-featured table detail modal component with:
  - Full table information display (name, capacity, zone, guests, status)
  - Status indicator with color-coded badge
  - Tab-based interface with "Active Order" and "History" tabs
  - Active order details with:
    - Order header (code, status, item count, total)
    - Order items list with status badges
    - Item details (name, quantity, notes, subtotal)
    - Decline reason display for declined items
    - Strikethrough styling for declined/canceled items
    - Ready items count indicator in tab
  - Order history section with:
    - Scrollable list of past orders (today)
    - Order cards showing code, status, time, items, total
    - Loading state with ActivityIndicator
    - Empty state message
  - Action buttons:
    - "New Order" / "Add Items" (changes based on active order)
    - "View Bill" (when active order exists)
    - "Transfer" for table transfer
  - Animated entrance/exit using react-native-reanimated
  - Backdrop press to close
  - Close button (âœ•)
  - Theme-aware colors (light/dark mode support)
  - Proper TypeScript types and testIDs for all interactive elements

**Helper Functions Exported:**
- `getTranslatedText(translation, fallback)` - Get translated text from Translation object
- `getStatusBadgeVariant(status)` - Map table status to badge variant
- `getTableStatusLabel(status)` - Get human-readable table status label
- `getOrderItemStatusColor(status)` - Get color for order item status
- `getOrderItemStatusLabel(status)` - Get human-readable order item status label
- `getOrderItemBadgeVariant(status)` - Map order item status to badge variant
- `getOrderStatusBadgeVariant(status)` - Map order status to badge variant
- `formatTime(dateString)` - Format date string to time display

**Files Modified:**
- `components/tables/index.ts` - Updated to export TableDetailModal component and all helper functions/types
- `jest.config.js` - Added table-detail-modal.test.tsx to web test match patterns

**Types Defined:**
- `TableDetailModalProps` - Component props interface:
  - visible: boolean
  - onClose: () => void
  - table: TableItemData | null
  - activeOrder?: Order | null
  - orderHistory?: Order[]
  - isLoadingHistory?: boolean
  - onNewOrder?: (table: Table) => void
  - onViewBill?: (order: Order) => void
  - onTransferTable?: (table: Table) => void
  - onSelectOrder?: (order: Order) => void
  - onSelectOrderItem?: (item: OrderItem) => void
  - testID?: string

**Tests Created:**
- `src/__tests__/table-detail-modal.test.tsx` - 94 tests covering:
  - Helper functions (46 tests):
    - getTranslatedText (5 tests): English, fallback, empty string, Russian fallback, Turkmen fallback
    - getStatusBadgeVariant (5 tests): all status types and unknown fallback
    - getTableStatusLabel (5 tests): all status types and unknown fallback
    - getOrderItemStatusColor (7 tests): all order item status types
    - getOrderItemStatusLabel (8 tests): all order item status types
    - getOrderItemBadgeVariant (7 tests): all order item status types
    - getOrderStatusBadgeVariant (5 tests): all order status types
    - formatTime (3 tests): valid date, invalid date, empty string
  - Visibility (4 tests): render when visible, hide when not visible or no table
  - Table info display (5 tests): title, capacity, zone name, guest count
  - Status badge (4 tests): correct badge for all status types
  - Active order display (5 tests): order code, items, total, tab label, ready count
  - Order item display (5 tests): name, quantity, notes, decline reason, subtotal
  - Order history (3 tests): history count, loading state, empty message
  - Action buttons (6 tests): New Order, Add Items, View Bill, Transfer visibility
  - Close functionality (3 tests): close button, backdrop, callback
  - Edge cases (4 tests): missing zone, missing orderItems, undefined guestCount, empty history
  - Export verification (9 tests): component and all helper function exports
  - Type export verification (1 test)

**Test Results:**
- 581 tests passing (487 previous + 94 table detail modal tests)

**Linting:**
- All files pass Biome linting checks (1 acceptable warning for array index key in SkeletonGroup)

---

### Task 2.7: Implement "My Section" View (COMPLETED)

**Files Created:**
- `src/__tests__/my-section.test.tsx` - 50 tests covering all "My Section" functionality

**Files Modified:**
- `src/stores/tableStore.ts` - Added "My Section" state and actions:
  - `TableViewMode` type: 'all' | 'mySection'
  - `viewMode` state: Current view mode (all tables or my section)
  - `assignedTableIds` state: Set of table IDs assigned to current waiter
  - `setViewMode(mode)` - Set the view mode
  - `toggleViewMode()` - Toggle between 'all' and 'mySection'
  - `setAssignedTableIds(tableIds)` - Set the list of assigned table IDs
  - `addAssignedTableId(tableId)` - Add a table to assigned tables
  - `removeAssignedTableId(tableId)` - Remove a table from assigned tables
  - `isTableAssigned(tableId)` - Check if a table is assigned
  - `getAssignedTables()` - Get all assigned Table objects

- `src/stores/index.ts` - Added exports for new hooks and types:
  - `TableViewMode` type
  - `useViewMode` - Get current view mode
  - `useAssignedTableIds` - Get assigned table IDs Set
  - `useAssignedTables` - Get assigned Table objects
  - `useIsTableAssigned(tableId)` - Check if specific table is assigned
  - `useViewModeToggle` - Get view mode with toggle functions
  - `useTablesByViewMode` - Get tables filtered by view mode

- `components/tables/TableItem.tsx` - Added assigned table highlighting:
  - `isAssigned` prop: Whether table is assigned to current waiter
  - `showAssignedIndicator` prop: Show star indicator for assigned tables
  - Gold star indicator (â˜…) on bottom-left of assigned tables

- `app/(tabs)/tables/index.tsx` - Added "My Section" UI:
  - `ViewModeToggle` component: Toggle button between "My Tables" and "All Tables"
    - Shows assigned count badge when in "My Tables" mode
    - Hint text showing counts (e.g., "3 of 10 assigned to you")
  - `MySectionEmptyState` component: Empty state when no tables assigned
    - "Show All Tables" button to switch view modes
  - Updated `FloorPlanCanvas` to pass `assignedTableIds` and `highlightAssigned`
  - Tables filtered by view mode in addition to zone filter
  - Assigned tables highlighted with star indicator in "All Tables" view

- `jest.config.js` - Added my-section.test.tsx to node test patterns

**Features Implemented:**
- Quick toggle between "My Tables" and "All Tables" views
- Filter floor plan to show only waiter's assigned tables in "My Section" mode
- Star indicator (â˜…) highlighting assigned tables in "All Tables" view
- Empty state with "Show All Tables" button when no assigned tables
- Assigned count display in toggle button and hint text
- Store-level state management for assigned tables
- Full support for adding/removing individual table assignments

**Custom Hooks Added:**
- `useViewMode()` - Returns current view mode ('all' | 'mySection')
- `useAssignedTableIds()` - Returns Set of assigned table IDs
- `useAssignedTables()` - Returns array of assigned Table objects
- `useIsTableAssigned(tableId)` - Returns boolean for specific table
- `useViewModeToggle()` - Returns viewMode, toggleViewMode, setViewMode
- `useTablesByViewMode()` - Returns tables filtered by current view mode

**Tests Created:**
- 50 tests covering:
  - TableStore view mode state (2 tests)
  - setViewMode action (2 tests)
  - toggleViewMode action (3 tests)
  - setAssignedTableIds action (3 tests)
  - addAssignedTableId action (3 tests)
  - removeAssignedTableId action (2 tests)
  - isTableAssigned action (2 tests)
  - getAssignedTables action (3 tests)
  - reset action (2 tests)
  - useViewMode hook (2 tests)
  - useAssignedTableIds hook (1 test)
  - useAssignedTables hook (1 test)
  - useIsTableAssigned hook (2 tests)
  - useViewModeToggle hook (2 tests)
  - useTablesByViewMode hook (2 tests)
  - TableViewMode type (2 tests)
  - Store exports verification (7 tests)
  - TableState interface verification (9 tests)

**Test Results:**
- 631 tests passing (581 previous + 50 my-section tests)

**Linting:**
- All files pass Biome linting checks (1 acceptable warning for array index key in SkeletonGroup)

---

### Task 2.8: Add table status legend (COMPLETED)

**Files Created:**
- `components/tables/StatusLegend.tsx` - Full-featured collapsible status legend component with:
  - Color key for all table statuses (available, occupied, reserved, needs attention)
  - Collapsible functionality to save screen space
  - Animated expand/collapse transitions using react-native-reanimated
  - Theme-aware colors (light/dark mode support)
  - Optional assigned table indicator (star icon for "Your Table")
  - Configurable position (bottom-right, bottom-left, top-right, top-left)
  - `getStatusItems()` helper function exported for testing
  - Proper testIDs for all interactive elements
  - Props: initialExpanded, showAssignedIndicator, position, testID

**Files Modified:**
- `components/tables/index.ts` - Updated to export StatusLegend component, getStatusItems function, and StatusLegendProps type
- `app/(tabs)/tables/index.tsx` - Updated to use reusable StatusLegend component:
  - Removed inline StatusLegend implementation
  - Imported StatusLegend from @/components/tables
  - Shows assigned indicator when in "all" view mode with assigned tables
  - Removed unused legend-related styles
  - Removed unused getStatusColor import
- `jest.config.js` - Added status-legend.test.tsx to web test match patterns

**Tests Created:**
- `src/__tests__/status-legend.test.tsx` - 33 tests covering:
  - getStatusItems helper function (5 tests):
    - Returns all four status items
    - Includes available status with correct color
    - Includes occupied status with correct color
    - Includes reserved status with correct color
    - Includes needsAttention status with correct color
  - Rendering (3 tests):
    - Renders and displays Legend text when collapsed
    - Renders toggle button with chevron
    - Component renders without errors
  - Collapsible functionality (5 tests):
    - Starts collapsed by default
    - Starts expanded when initialExpanded is true
    - Contains all status labels in DOM when rendered
    - Collapsed and expanded states show different text
    - Shows Hide Legend text when expanded
  - Status items display (5 tests):
    - Displays Available, Occupied, Reserved, Needs Attention labels
    - Displays all four status labels when expanded
  - Assigned indicator (4 tests):
    - Does not show Your Table text when showAssignedIndicator is false
    - Shows Your Table text when showAssignedIndicator is true
    - Shows star icon when showAssignedIndicator is true
    - Does not show star icon when showAssignedIndicator is false
  - Position variations (5 tests):
    - Renders with all position options (bottom-right, bottom-left, top-right, top-left)
    - All positions render the same content
  - Theme support (1 test)
  - Exports (2 tests): StatusLegend component and getStatusItems function
  - Export verification from index (3 tests)

**Features Implemented:**
- Collapsible legend with animated expand/collapse
- Color key for all table status types (Available, Occupied, Reserved, Needs Attention)
- Status colors match theme StatusColors
- Optional "Your Table" indicator with gold star icon
- Four position options for placement on screen
- Theme-aware styling (light/dark mode)

**Test Results:**
- 664 tests passing (631 previous + 33 status legend tests)

**Linting:**
- All files pass Biome linting checks (1 acceptable warning for array index key in SkeletonGroup)

---

### Task 3.1: Create menu store (COMPLETED)

**Files Created:**
- `src/stores/menuStore.ts` - Full-featured Zustand menu store with:
  - `MenuState` interface defining all state and actions
  - Menu categories array cache from API
  - Menu items array cache from API
  - Extras array cache from API
  - Selected category ID tracking
  - Search query state for filtering
  - Recently used item IDs tracking (persisted to AsyncStorage)
  - Loading states for categories, items, and extras (independent)
  - Error state handling
  - `fetchCategories()` - Fetches all menu categories from API
  - `fetchItems()` - Fetches all active menu items from API
  - `fetchExtras()` - Fetches all active extras from API
  - `fetchAll()` - Fetches categories, items, and extras in parallel
  - `selectCategory(categoryId)` - Selects a category by ID
  - `setSearchQuery(query)` - Sets the search query for filtering
  - `getCategoryById(categoryId)` - Returns category by ID (including nested children)
  - `getItemById(itemId)` - Returns menu item by ID
  - `getExtraById(extraId)` - Returns extra by ID
  - `getItemsByCategory(categoryId)` - Returns all items in a category
  - `getFilteredItems()` - Returns items filtered by selected category and search query
  - `searchItems(query)` - Searches items by title and description (all languages)
  - `addToRecentItems(itemId)` - Adds item to recently used list (max 20, persisted)
  - `getRecentItems()` - Returns recently used MenuItem objects
  - `clearRecentItems()` - Clears recently used items
  - `loadRecentItems()` - Loads recently used items from AsyncStorage
  - `clearError()` - Clears error message
  - `reset()` - Resets store to initial state

**Helper Functions Exported:**
- `getTranslatedText(translation, fallback, preferredLang)` - Get translated text from Translation object

**Custom Hooks Exported:**
- `useMenuStore` - Full store access
- `useMenuCategories` - Optimized hook for categories array only
- `useMenuItems` - Optimized hook for items array only
- `useExtras` - Optimized hook for extras array only
- `useSelectedCategory` - Returns the full selected category object
- `useSearchQuery` - Returns the current search query
- `useFilteredItems` - Returns items filtered by category and search query
- `useItemsByCategory(categoryId)` - Returns items filtered by category
- `useRecentItems` - Returns recently used MenuItem objects
- `useMenuLoading` - Loading states (isLoadingCategories, isLoadingItems, isLoadingExtras, isLoading)
- `useMenuError` - Error state only
- `useSelectedCategoryId` - Selected category ID only
- `useRecentItemIds` - Recent item IDs array only

**Files Modified:**
- `src/stores/index.ts` - Updated to export all menu store functions and types
- `jest.config.js` - Added menu-store.test.ts to node test match patterns

**Tests Created:**
- `src/__tests__/menu-store.test.ts` - 77 tests covering:
  - Initial state verification
  - fetchCategories success, loading state, and error handling
  - fetchItems success, loading state, and error handling
  - fetchExtras success, loading state, and error handling
  - fetchAll parallel execution
  - selectCategory functionality
  - setSearchQuery functionality
  - getCategoryById (top-level and nested categories)
  - getItemById functionality
  - getExtraById functionality
  - getItemsByCategory filtering
  - getFilteredItems (no filters, category filter, search filter, combined filters)
  - searchItems (empty query, title search, description search, case insensitive)
  - addToRecentItems (add, move to front, limit max, persistence)
  - getRecentItems (as MenuItem objects, filter non-existent)
  - clearRecentItems functionality and persistence
  - loadRecentItems from AsyncStorage (valid data, null, invalid JSON, non-array)
  - clearError functionality
  - reset functionality
  - getTranslatedText helper (10 tests for language fallbacks)
  - All hook exports verification (12 tests)
  - MenuState type export verification
  - Store index exports verification

**Test Results:**
- 741 tests passing (664 previous + 77 menu store tests)

**Linting:**
- All files pass Biome linting checks

---

### Task 3.2: Implement Menu data fetching (COMPLETED)

**Files Created:**
- `src/hooks/useMenuQueries.ts` - Full-featured React Query hooks for menu data fetching with:
  - Query key factories (`menuCategoryQueryKeys`, `menuItemQueryKeys`, `extraQueryKeys`) for targeted cache invalidation
  - `useMenuCategories(options?)` - Fetch all menu categories with optional filtering/pagination
  - `useMenuCategory({ id })` - Fetch a single category by ID
  - `useMenuItems(options?)` - Fetch all menu items with optional filtering/pagination
  - `useMenuItem({ id })` - Fetch a single menu item by ID
  - `useExtras(options?)` - Fetch all extras with optional filtering/pagination
  - `useExtra({ id })` - Fetch a single extra by ID
  - `useMenuData(options?)` - Combined hook to fetch categories, items, and extras together
    - Syncs data to menu store by default (configurable via `syncToStore` option)
    - `refetchAll()` function for pull-to-refresh support
  - `useMenuItemsByCategory(items, categoryId)` - Filter items by category from cached data
  - `useMenuItemSearch(items, query)` - Search items by name/description in all languages
  - `useActiveMenuItems(items)` - Filter to only active items
  - `useExtrasForItem(extras, extraIds)` - Get extras for a specific menu item
  - `useMenuCacheActions()` - Cache management utilities:
    - `invalidateCategories(params?)`, `invalidateItems(params?)`, `invalidateExtras(params?)`
    - `invalidateAll()` - Invalidate all menu data
    - `prefetchCategories(params?)`, `prefetchItems(params?)`, `prefetchExtras(params?)`
    - `prefetchAll()` - Prefetch all menu data
  - Default stale time: 10 minutes (menu changes less frequently)
  - Default cache time: 60 minutes

**Files Modified:**
- `src/stores/menuStore.ts` - Added setter methods for React Query sync:
  - `setCategories(categories)` - Set categories directly
  - `setItems(items)` - Set items directly
  - `setExtras(extras)` - Set extras directly
- `src/hooks/index.ts` - Updated to export all menu query hooks and types
- `jest.config.js` - Added menu-queries.test.tsx to web test match patterns

**Tests Created:**
- `src/__tests__/menu-queries.test.tsx` - 70 tests covering:
  - Query keys generation (18 tests):
    - menuCategoryQueryKeys: all, lists, list with/without params, details, detail
    - menuItemQueryKeys: all, lists, list with/without params, details, detail
    - extraQueryKeys: all, lists, list with/without params, details, detail
  - useMenuCategories hook (3 tests): fetch, filter by type, error handling
  - useMenuCategory hook (2 tests): fetch by ID, disabled when empty
  - useMenuItems hook (4 tests): fetch, active filter, category filter, error handling
  - useMenuItem hook (2 tests): fetch by ID, disabled when empty
  - useExtras hook (3 tests): fetch, active filter, error handling
  - useExtra hook (2 tests): fetch by ID, disabled when empty
  - useMenuData hook (5 tests): fetch all, error handling, refetchAll, store sync, sync disabled
  - useMenuItemsByCategory utility (4 tests): filter, undefined category, undefined items, no match
  - useMenuItemSearch utility (8 tests): English/Russian/description search, case insensitive, empty query
  - useActiveMenuItems utility (2 tests): filter active, undefined items
  - useExtrasForItem utility (5 tests): match extras, empty/undefined extraIds, undefined extras, filter non-existent
  - useMenuCacheActions hook (10 tests): all functions, invalidation, prefetching
  - Hook exports verification (2 tests)

**Test Results:**
- 811 tests passing (741 previous + 70 menu queries tests)

**Linting:**
- All files pass Biome linting checks (1 acceptable warning for array index key in SkeletonGroup)

---

### Task 3.3: Create Order Entry Screen (COMPLETED)

**Files Created:**
- `app/(main)/_layout.tsx` - Main route group layout with Stack navigator for order screens
- `app/(main)/order/new.tsx` - Full-featured Order Entry Screen with:
  - `LocalOrderItem` interface for local order state (before API submission)
  - `LocalOrder` interface for complete order state
  - `parsePrice(price)` - Parse price string to number
  - `formatPrice(price)` - Format number to 2 decimal places
  - `calculateExtrasTotal(extras, availableExtras)` - Calculate extras total price
  - `calculateItemSubtotal(item, availableExtras)` - Calculate item subtotal with extras
  - `calculateOrderTotal(items)` - Calculate total order amount
  - `CategoryChip` component - Individual category chip with Kitchen/Bar color coding
  - `CategoryList` component - Horizontal scrollable category chips with "All" option
  - `MenuSearch` component - Search input with clear button
  - `MenuItemCard` component - Menu item card with quantity badge, unavailable overlay, press animation
  - `MenuItemGrid` component - Grid of menu items (2 columns for phone, 3 for tablet)
  - `OrderSummaryItem` component - Order item with quantity controls, remove button, extras/notes display
  - `OrderSummary` component - Order items list with totals and "Send to Kitchen" button
  - `OrderEntrySkeleton` component - Loading skeleton for initial load
  - `OrderEntryScreen` - Main screen with split-screen layout (tablet) or stacked (phone)
  - Table header with zone name display
  - Category filtering and search functionality
  - Live order summary with running totals
  - Pull-to-refresh for menu data
  - Loading overlay for background fetches

- `src/__tests__/order-entry-screen.test.tsx` - 48 tests covering:
  - Helper functions (12 tests):
    - parsePrice: valid prices, undefined/empty, invalid strings
    - formatPrice: decimal formatting, zero handling
    - calculateExtrasTotal: with extras, empty array, non-existent extras
    - calculateItemSubtotal: base price, with extras
    - calculateOrderTotal: sum subtotals, empty order
  - Route Parameters (1 test): tableId from route params
  - Data Fetching Integration (4 tests): useMenuData, useTable, loading state, refetchAll
  - Category Filtering (3 tests): filter by category, all items, store update
  - Search Filtering (5 tests): title search, description search, case insensitive, store update, combined filter
  - Menu Item Data (3 tests): price, isActive, categoryId
  - Category Data (2 tests): type property, translation structure
  - Extras Data (2 tests): actualPrice, isActive
  - Table Data (2 tests): zone information, title display
  - Order State Management (2 tests): order item fields, extras structure
  - Navigation (1 test): router.back
  - Module Export (2 tests): default export, helper function exports
  - Translation Helper (3 tests): English default, fallback, language fallthrough
  - Inactive Items (2 tests): identify inactive, active selectable
  - Category Colors (2 tests): Kitchen orange, Bar blue
  - Screen Layout (2 tests): tablet breakpoint, sidebar width

**Files Modified:**
- `app/_layout.tsx` - Added `(main)` route group to Stack navigator

**Features Implemented:**
- Split-screen layout: Menu (left/top) + Order Summary (right/bottom)
- Responsive design: Tablet (side-by-side) vs Phone (stacked)
- Menu categories with horizontal scrollable chips
- Color-coded categories (Kitchen: orange, Bar: blue)
- Menu search with real-time filtering
- Menu item grid with quantity badges
- Unavailable items grayed out with overlay
- Press animation on menu item cards
- Live order summary with item list
- Quantity controls (+/-) for each order item
- Remove item functionality
- Running totals display
- "Send to Kitchen" button (API implementation pending Task 3.10)
- Pull-to-refresh for menu data
- Loading skeleton on initial load
- Table header with zone name

**Test Results:**
- 859 tests passing (811 previous + 48 order entry screen tests)

**Linting:**
- All files pass Biome linting checks

---

### Task 3.4: Create Menu Categories Component (COMPLETED)

**Files Created:**
- `components/menu/CategoryList.tsx` - Full-featured menu categories component with:
  - Two display variants:
    - `horizontal`: Scrollable category chips (default)
    - `vertical`: Collapsible list with subcategories
  - `CategoryChip` component - Individual category chip with:
    - Kitchen/Bar color coding (orange/blue from CategoryColors)
    - Active category highlighting
    - Press animation using react-native-reanimated
    - Size variants (sm, md, lg)
  - `CollapsibleCategory` component - Vertical list row with:
    - Category type color indicator (dot)
    - Expandable/collapsible subcategories
    - Chevron rotation animation
    - Depth-based indentation for nested categories
    - Selected state highlighting with border accent
  - `CategoryList` main component with:
    - "All" category option (configurable)
    - Custom "All" label support
    - Subcategory visibility toggle
    - Smooth scroll animation
    - Theme-aware colors (light/dark mode)
  - Helper functions exported:
    - `getTranslatedText(translation, fallback, preferredLang)` - Get translated text
    - `getCategoryColor(type)` - Get Kitchen (orange) or Bar (blue) color
    - `flattenCategories(categories)` - Flatten nested categories for filtering

- `components/menu/index.ts` - Central export file for menu components:
  - Named exports: CategoryList, CategoryChip, CollapsibleCategory, helper functions
  - Default export: CategoryList
  - Type exports: CategoryListProps, CategoryListVariant, CategoryChipProps, CollapsibleCategoryProps

**Files Modified:**
- `app/(main)/order/new.tsx` - Refactored to use new CategoryList component:
  - Removed inline CategoryChip and CategoryList implementations
  - Imports CategoryList from `@/components/menu`
  - Removed unused `getCategoryTranslatedText` import

- `jest.config.js` - Added category-list.test.tsx to web test match patterns

**Tests Created:**
- `src/__tests__/category-list.test.tsx` - 64 tests covering:
  - Helper functions (17 tests):
    - getTranslatedText: English, Russian, Turkmen, fallbacks, empty handling
    - getCategoryColor: Kitchen, Bar, undefined, unknown types
    - flattenCategories: empty, no children, with children, mixed, deeply nested
  - CategoryChip component (5 tests): export, render, title, selected, bar category
  - CollapsibleCategory component (4 tests): export, render, title, bar category
  - CategoryList component (7 tests): export, render, All option, hide All, custom label, horizontal mode, empty categories
  - Horizontal Variant (2 tests): default variant, explicit variant
  - Vertical Variant (3 tests): render, collapsible rows, All row
  - Category Selection (2 tests): selected styling, vertical selected
  - Type Exports (4 tests): CategoryListProps, CategoryChipProps, CollapsibleCategoryProps, CategoryListVariant
  - Module Exports (7 tests): all named and default exports from CategoryList.tsx
  - Index File Exports (7 tests): all exports from components/menu/index.ts
  - Category Color Coding (2 tests): Kitchen orange, Bar blue color values
  - Size Variants (4 tests): sm, md, lg, default md

**Features Implemented:**
- Horizontal scrollable category chips (default variant)
- Vertical list with collapsible subcategories
- Color-coded by type (Kitchen: orange #F97316, Bar: blue #3B82F6)
- Active category highlighting with colored background/border
- Smooth animations using react-native-reanimated
- Press scale animation on chips
- Chevron rotation on expand/collapse
- "All" category option with primary color
- Configurable "All" label
- Nested subcategory support with depth indentation
- Theme-aware colors (light/dark mode)
- Full TypeScript types and testIDs

**Test Results:**
- 923 tests passing (859 previous + 64 category list tests)

**Linting:**
- All files pass Biome linting checks (1 acceptable warning for array index key in SkeletonGroup)

---

### Task 3.5: Create Menu Item Grid/List (COMPLETED)

**Files Created:**
- `components/menu/MenuItemList.tsx` - Full-featured menu item display component with:
  - Two display variants:
    - `grid`: Grid layout for tablets (2-3 columns based on screen width)
    - `list`: Single-column list layout for phones
    - `auto`: Automatically selects based on screen width (default)
  - `MenuItemCard` component - Individual menu item card with:
    - High-quality images using expo-image with fallback placeholder
    - Item name with translation support (en/ru/tm)
    - Brief description (optional, configurable)
    - Price display with proper formatting
    - "Unavailable" overlay for inactive items (isActive: false)
    - Quantity badge showing items already in order
    - Press animation using react-native-reanimated
    - Long-press support for additional actions
  - `MenuItemList` main component with:
    - FlatList-based rendering for performance
    - Dynamic column count (2 for phones, 3 for tablets)
    - Configurable via numColumns prop
    - Pull-to-refresh support via onRefresh/refreshing props
    - Empty state display with customizable message
    - Theme-aware colors (light/dark mode)
  - Helper functions exported:
    - `getTranslatedText(translation, fallback, preferredLang)` - Get translated text
    - `parsePrice(price)` - Parse price string to number
    - `formatPrice(price)` - Format number to 2 decimal places
    - `getFormattedPrice(price)` - Combined parse and format with $ prefix

- `components/menu/index.ts` - Updated to export MenuItemList components:
  - Named exports: MenuItemList, MenuItemCard, helper functions
  - Default export: MenuItemList
  - Type exports: MenuItemListProps, MenuItemListVariant, MenuItemCardProps

**Files Modified:**
- `jest.config.js` - Added menu-item-list.test.tsx to web test match patterns
- `jest.setup.js` - Added expo-image mock for testing

**Tests Created:**
- `src/__tests__/menu-item-list.test.tsx` - 76 tests covering:
  - Helper functions (20 tests):
    - getTranslatedText: English, Russian, Turkmen, fallbacks, empty handling, undefined
    - parsePrice: valid prices, undefined/empty, invalid strings, zero
    - formatPrice: decimal formatting, zero, whole numbers
    - getFormattedPrice: formatted with dollar sign, empty price
  - MenuItemCard component (13 tests):
    - Render with title, price, description
    - Image display with and without imagePath
    - Unavailable overlay for inactive items
    - Quantity badge display
    - Press and long-press handlers
    - Grid and list variants
  - MenuItemList component (12 tests):
    - Render with items
    - Empty state with custom message
    - Grid variant with columns
    - List variant single column
    - Auto variant selection
    - Pull-to-refresh support
    - Item quantities display
  - Type Exports (4 tests): MenuItemListProps, MenuItemCardProps, MenuItemListVariant
  - Module Exports (8 tests): all named exports from MenuItemList.tsx
  - Index File Exports (19 tests): all exports from components/menu/index.ts

**Features Implemented:**
- Grid view for tablets (2-3 columns)
- List view for phones (single column)
- Auto-detect screen width for variant selection
- High-quality images with expo-image
- Fallback placeholder image
- Item name with translation support
- Price display with formatting ($X.XX)
- Brief description (optional)
- "Unavailable" overlay for inactive items
- Quantity badges for items in order
- Press animation using react-native-reanimated
- Long-press callback support
- Pull-to-refresh functionality
- Empty state display
- Theme-aware colors (light/dark mode)
- Full TypeScript types and testIDs

**Test Results:**
- 999 tests passing (923 previous + 76 menu item list tests)

**Linting:**
- All files pass Biome linting checks

---

### Task 3.6: Create Menu Search (COMPLETED)

**Files Created:**
- `components/menu/MenuSearch.tsx` - Full-featured menu search component with:
  - Prominent search bar at top
  - Real-time filtering as user types with debounce (300ms delay)
  - Search across name and description
  - Recent searches history with AsyncStorage persistence
  - Clear button to reset search
  - Focus/blur animations using react-native-reanimated
  - Theme-aware colors (light/dark mode)
  - `MenuSearch` main component with all features
  - `ClearButton` component with fade animation
  - `SearchIcon` component
  - `RecentSearchItemRow` component for individual recent search entries
  - `RecentSearchesDropdown` component with header and Clear All button
  - Configurable props: showRecentSearches, maxRecentSearches, autoFocus, disabled
  - Full TypeScript types and testIDs for all interactive elements

**Utility Functions Exported:**
- `loadRecentSearches()` - Load recent searches from AsyncStorage
- `saveRecentSearches(searches)` - Save recent searches to AsyncStorage
- `addToRecentSearches(searches, query, maxSearches)` - Add a search to the list
- `removeFromRecentSearches(searches, query)` - Remove a search from the list
- `clearRecentSearches()` - Clear all recent searches from storage

**Types Exported:**
- `MenuSearchProps` - Component props interface
- `RecentSearchItem` - Recent search item with query and timestamp

**Files Modified:**
- `components/menu/index.ts` - Already exports MenuSearch component and all utility functions

**Tests Created:**
- `src/__tests__/menu-search.test.tsx` - 48 tests covering:
  - Utility functions (21 tests):
    - addToRecentSearches: add new, move existing, case-insensitive, max limit, empty/whitespace queries, trimming, timestamp
    - removeFromRecentSearches: remove, case-insensitive, not found, empty list
    - loadRecentSearches: load, null, invalid JSON, non-array, error handling
    - saveRecentSearches: save, error handling
    - clearRecentSearches: remove, error handling
  - Component rendering (6 tests): renders, input, icon, placeholder, value
  - Clear button (3 tests): hidden when empty, shown when content, hidden when disabled
  - Text input props (1 test): correct properties
  - Recent searches loading (2 tests): loads when enabled, skips when disabled
  - Export verification (13 tests): all component and function exports
  - Type verification (2 tests): MenuSearchProps, RecentSearchItem

**Features Implemented:**
- Prominent search bar at top of menu
- Real-time filtering as user types (debounced 300ms)
- Search icon with focus color change
- Clear button with fade animation
- Recent searches history dropdown
  - Shows when input focused and empty
  - Stores up to 10 recent searches (configurable)
  - Persisted to AsyncStorage
  - Individual remove buttons
  - Clear All button
  - Auto-hide on blur with delay
- Keyboard submit to add to history
- Disabled state support
- Theme-aware colors (light/dark mode)
- Full TypeScript types

**Test Results:**
- 1047 tests passing (999 previous + 48 menu search tests)

**Linting:**
- All files pass Biome linting checks (1 acceptable warning for array index key in SkeletonGroup)